# Error Handling Flow Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXECORA APPLICATION                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   REST Routes    â”‚    â”‚   WebSocket      â”‚    â”‚  Services  â”‚â”‚
â”‚  â”‚  (/api/...)      â”‚    â”‚  (/ws)           â”‚    â”‚  & Databaseâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜â”‚
â”‚           â”‚                       â”‚                       â”‚     â”‚
â”‚           â”‚ Handle error          â”‚ Handle error          â”‚     â”‚
â”‚           â”‚ (throw AppError)      â”‚ (throw AppError)      â”‚     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â”‚                       â”‚                 â”‚
â”‚                       â–¼                       â–¼                 â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚          â”‚     errorHandler.ts                  â”‚              â”‚
â”‚          â”‚  Centralized Error Processing        â”‚              â”‚
â”‚          â”‚                                      â”‚              â”‚
â”‚          â”‚  â”Œâ”€ logError()                      â”‚              â”‚
â”‚          â”‚  â”‚  - Classify error               â”‚              â”‚
â”‚          â”‚  â”‚  - Add severity level           â”‚              â”‚
â”‚          â”‚  â”‚  â””â”€ Send to logging layer       â”‚              â”‚
â”‚          â”‚  â”‚                                  â”‚              â”‚
â”‚          â”‚  â”œâ”€ formatErrorResponse()           â”‚              â”‚
â”‚          â”‚  â”‚  - For HTTP API responses        â”‚              â”‚
â”‚          â”‚  â”‚                                  â”‚              â”‚
â”‚          â”‚  â”œâ”€ formatWebSocketError()          â”‚              â”‚
â”‚          â”‚  â”‚  - For WebSocket messages       â”‚              â”‚
â”‚          â”‚  â”‚                                  â”‚              â”‚
â”‚          â”‚  â””â”€ handle() / tryCatch()           â”‚              â”‚
â”‚          â”‚     - Wrapper functions             â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                         â”‚                                      â”‚
â”‚                         â–¼                                      â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚          â”‚     logger.ts (Pino Logger)          â”‚              â”‚
â”‚          â”‚  Different levels:                   â”‚              â”‚
â”‚          â”‚  - logger.fatal() ğŸš¨ CRITICAL        â”‚              â”‚
â”‚          â”‚  - logger.error() âŒ ERROR           â”‚              â”‚
â”‚          â”‚  - logger.warn()  âš ï¸ WARNING         â”‚              â”‚
â”‚          â”‚  - logger.info()  â„¹ï¸ INFO            â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  logs/app.log         â”‚    â”‚  Global Handlers    â”‚
        â”‚  (Local File)         â”‚    â”‚  Process & Errors   â”‚
        â”‚                       â”‚    â”‚  - Unhandled        â”‚
        â”‚  âœ“ View last 100:     â”‚    â”‚    Rejection        â”‚
        â”‚    tail -100 app.log  â”‚    â”‚  - Uncaught         â”‚
        â”‚                       â”‚    â”‚    Exception        â”‚
        â”‚  âœ“ Search errors:     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚    grep ERROR app.log â”‚                 â”‚
        â”‚                       â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                    â”‚                             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Loki Log Aggregator               â”‚
                â”‚   (Central Monitoring)              â”‚
                â”‚                                     â”‚
                â”‚  â”Œâ”€ Store structured logs          â”‚
                â”‚  â”œâ”€ Index by: category, severity   â”‚
                â”‚  â”œâ”€ Timestamp, service, version    â”‚
                â”‚  â””â”€ Queryable by Grafana           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Grafana Dashboard                 â”‚
                â”‚   http://localhost:3001/d/grafana   â”‚
                â”‚                                     â”‚
                â”‚  âœ“ View errors by category          â”‚
                â”‚  âœ“ Filter by severity               â”‚
                â”‚  âœ“ Time series charts               â”‚
                â”‚  âœ“ Set up alerts                    â”‚
                â”‚  âœ“ Track error trends               â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request-to-Response Flow (Success Case)

```
Browser/Client
     â”‚
     â–¼
GET /api/v1/customers
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fastify Route      â”‚
â”‚  Handler            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate input  â”‚  âœ… Pass
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Call Service Layer         â”‚
â”‚ (wrapped with             â”‚
â”‚ ErrorHandler.handle())     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Query         â”‚  âœ… Success
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Format Response        â”‚
â”‚ code(200).send(data)   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
Browser/Client
{ "success": true, "data": {...} }
```

---

## Request-to-Response Flow (Error Case)

```
Browser/Client
     â”‚
     â–¼
GET /api/v1/customers/invalid-id
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fastify Route      â”‚
â”‚  Handler            â”‚
â”‚  try {              â”‚
â”‚    ...              â”‚
â”‚  } catch (error)    â”‚  âš ï¸ Exception
â”‚  (auto-caught)      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Unknown error?       â”‚  âœ… Yes
â”‚ Wrap in AppError     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fastify Error Handler      â”‚
â”‚ setErrorHandler((e) => {}) â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ErrorHandler.logError()    â”‚
â”‚ - Record error type        â”‚
â”‚ - Add severity level       â”‚
â”‚ - Capture context/metadata â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Logger (Pino)              â”‚
â”‚ Send to log file + Loki    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ErrorHandler.format        â”‚
â”‚ ErrorResponse()            â”‚
â”‚ - Status code 404/500/...  â”‚
â”‚ - Error message            â”‚
â”‚ - Category, timestamp      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reply.code(404).send()     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
Browser/Client
{
  "error": {
    "message": "Customer not found",
    "category": "notfound",
    "statusCode": 404,
    "timestamp": "2026-02-20T..."
  }
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Meanwhile...                 â”‚
â”‚ Error also logged in:        â”‚
â”‚ 1. logs/app.log (file)       â”‚
â”‚ 2. Loki (Grafana dashboard)  â”‚
â”‚                              â”‚
â”‚ Can monitor/alert on it      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Classification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         All Errors in Application                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Severity   â”‚   â”‚   Category       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸš¨ CRITICAL  â”‚   â”‚ validation       â”‚
â”‚ âŒ HIGH      â”‚   â”‚ authentication   â”‚
â”‚ âš ï¸ MEDIUM    â”‚   â”‚ database         â”‚
â”‚ â„¹ï¸ LOW       â”‚   â”‚ external_service â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ websocket        â”‚
                   â”‚ business_logic   â”‚
                   â”‚ not_found        â”‚
                   â”‚ conflict         â”‚
                   â”‚ rate_limit       â”‚
                   â”‚ unknown          â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each error has BOTH:
- Severity (how urgent)
- Category (what type)

Example:
  ValidationError
  - Severity: MEDIUM (can fix)
  - Category: validation (bad input)
  - Status: 400
  - Action: Return to client to fix

Example:
  DatabaseError
  - Severity: HIGH (system issue)
  - Category: database (infrastructure)
  - Status: 500
  - Action: Alert ops team, retry
```

---

## Monitoring Dashboard Example

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           EXECORA ERROR MONITORING DASHBOARD                   â•‘
â•‘              http://localhost:3001/d/grafana                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  ğŸ“Š ERRORS IN LAST HOUR                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚                                    /\                  â”‚   â•‘
â•‘  â”‚                   /\       /\      /  \                â”‚   â•‘
â•‘  â”‚    /\            /  \     /  \    /    \               â”‚   â•‘
â•‘  â”‚   /  \---/\  ---/    \---/    \--/      \---          â”‚   â•‘
â•‘  â”‚  Total: 24 errors                                      â”‚   â•‘
â•‘  â”‚  Avg: 2 per 10 min                                     â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                â•‘
â•‘  ğŸš¨ BY SEVERITY                     ğŸ“ BY CATEGORY             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
â•‘  â”‚ CRITICAL:    2    â”‚             â”‚ validation: 8     â”‚      â•‘
â•‘  â”‚ HIGH:        8    â”‚             â”‚ database:   6     â”‚      â•‘
â•‘  â”‚ MEDIUM:      10   â”‚             â”‚ external:   5     â”‚      â•‘
â•‘  â”‚ LOW:         4    â”‚             â”‚ websocket:  3     â”‚      â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ other:      2     â”‚      â•‘
â•‘                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â•‘
â•‘  ğŸ”´ RECENT ERRORS                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ 10:35 âŒ DATABASE: "Connection timeout"                â”‚   â•‘
â•‘  â”‚       Details: operation=fetchCustomer, retries=3     â”‚   â•‘
â•‘  â”‚                                                        â”‚   â•‘
â•‘  â”‚ 10:32 âš ï¸  VALIDATION: "Invalid phone number"           â”‚   â•‘
â•‘  â”‚       Details: phone="+123", userId=user-456          â”‚   â•‘
â•‘  â”‚                                                        â”‚   â•‘
â•‘  â”‚ 10:28 â„¹ï¸  NOT_FOUND: "Customer with ID 999 not found" â”‚   â•‘
â•‘  â”‚       Details: operation=getCustomer, id=999          â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                â•‘
â•‘  âš™ï¸ ALERTS CONFIGURED:                                         â•‘
â•‘  âœ“ Critical errors > 1 per hour                               â•‘
â•‘  âœ“ High errors > 5 per hour                                   â•‘
â•‘  âœ“ DATABASE errors > 2 per hour                               â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Quick Decision Tree

```
Got an error?
     â”‚
     â–¼
Is it API request?  â”€â”€NOâ”€â”€â†’ Is it WebSocket?  â”€â”€NOâ”€â”€â†’ Other code?
     â”‚ YES                       â”‚ YES                   â”‚ YES
     â”‚                           â”‚                       â”‚
     â–¼                           â–¼                       â–¼
Route handler              WebSocket handler         Service/DB layer
     â”‚                           â”‚                       â”‚
     â”œâ”€ Throw specific          â”œâ”€ Throw specific       â”œâ”€ Wrap with
     â”‚  error class              â”‚  error class           â”‚  ErrorHandler
     â”‚  (NotFound,               â”‚  (WebSocketError)      â”‚  .handle()
     â”‚   ValidationError)        â”‚                        â”‚
     â”‚                           â”œâ”€ Log with:            â”œâ”€ Or use
     â”œâ”€ Fastify error             â”‚  ErrorHandler.        â”‚  .tryCatch()
     â”‚  handler catches           â”‚  logError()            â”‚  for non-
     â”‚  & formats                 â”‚                        â”‚  critical
     â”œâ”€ Returns to               â”œâ”€ Send to browser     â”‚
     â”‚  browser with              â”‚  via sendError()     â””â”€ Error has
     â”‚  error JSON                â”‚                        full context
     â”‚                            â””â”€ Logged to file    
     â–¼                              + Loki           
Browser shows
error to user
```

---

## Summary

**Before (Fragmented):**
```
Route â†’ console.log() â†’ Browser shows ???
Service â†’ logger.error() â†’ Buried in logs
WebSocket â†’ No consistent logging
Result: Hard to debug, no monitoring
```

**After (Centralized):**
```
Route â”€â”
       â”œâ†’ Specific Error Class â”€â†’ ErrorHandler â”€â†’ Structured Log
Service â”¤   (9 types)           â”œâ”€ logError()   â”œâ”€ logs/app.log
WebSocket â”˜                      â”œâ”€ format()    â”œâ”€ Loki
                                 â””â”€ track()     â””â”€ Grafana
                                                   â”œâ”€ Error Dashboard
                                                   â”œâ”€ Alerts
                                                   â””â”€ Monitoring
                                                   
Result: Everything visible in one place! ğŸ¯
```
